# 🚀 Шпаргалка по быстрому тестированию

```
┌─────────────────────────────────────────────────────────────┐
│  БЫСТРОЕ ТЕСТИРОВАНИЕ VOLLEYBOT                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1️⃣  python test_bot.py    ← Запустить тестовый бот       │
│  2️⃣  Найти бота в Telegram  ← Открыть мессенджер           │
│  3️⃣  /start                 ← Отправить команду            │
│  4️⃣  /open 1                ← Открыть опрос                │
│  5️⃣  Тестировать функции    ← Нажимать кнопки, команды     │
│  6️⃣  Ctrl+C                 ← Остановить (данные удалятся) │
│                                                             │
│  ✅ Основная БД не затрагивается                            │
│  ✅ Все изменения временные                                 │
│  ✅ Можно тестировать в любом чате                          │
└─────────────────────────────────────────────────────────────┘
```

## Самый простой способ протестировать бота

### 1. Запустите тестовый бот

```bash
python test_bot.py
```

**Что это дает:**
- ✅ Временная БД (основная не затрагивается)
- ✅ Автоматически создан тестовый опрос
- ✅ Можно тестировать в любом чате
- ✅ После остановки все удаляется

### 2. Взаимодействуйте с ботом

Найдите бота в Telegram и отправьте:

```
/start          - Включить бота
/open 1         - Открыть тестовый опрос
/pay            - Тестировать оплату
/balance        - Проверить баланс
/list           - Список всех опросов
```

### 3. Остановите бота

Нажмите `Ctrl+C` — все тестовые данные удалятся автоматически.

---

## 🔍 Получить Chat ID для настройки

```bash
python get_chat_id.py
```

1. Запустите скрипт
2. Отправьте боту сообщение (в личку или в группу)
3. Скопируйте Chat ID для использования в `.env`

```
Зачем нужен Chat ID?
├─ Для настройки CHAT_ID в .env
├─ Для тестирования в отдельной группе
└─ Для добавления новых админов (ADMIN_USER_ID)
```

---

## 👥 Тестирование с несколькими пользователями

1. Создайте тестовую группу в Telegram
2. Добавьте бота в группу
3. Пригласите друзей
4. Запустите `python test_bot.py`
5. Все могут взаимодействовать с ботом одновременно

```
Процесс:
  Тестовая группа → Добавить бота → python test_bot.py
                                          ↓
  Друзья могут → Команды → Опросы → Кнопки → Оплата
```

---

## 🔘 Тестирование inline-кнопок

Если кнопки не работают:

1. Запустите `python test_bot.py`
2. Отправьте `/pay`
3. Нажмите на кнопку
4. Проверьте логи: должно быть `callback_query`

Если не работает — смотрите [docs/TESTING.md](docs/TESTING.md#проблема-inline-кнопки-не-работают)

```
Диагностика inline-кнопок:
✓ Кнопки отображаются?         → Да
✓ При нажатии что-то происходит? → Нет
✓ В логах есть "callback_query"? → Нет
  └─→ Проблема с allowed_updates в webhook
       Решение: /webhookinfo → Проверить список updates
```

---

## 🧪 Автоматические тесты

```bash
# Запустить все тесты
./manage.sh test

# Запустить с покрытием
pytest tests/ --cov=src --cov-report=html

# Запустить конкретный тест
pytest tests/test_handlers.py::test_start_handler -v
```

```
Покрытие кода: 60%+
├─ handlers.py    ✅ покрыто
├─ services/      ✅ покрыто
├─ db.py          ✅ покрыто
└─ scheduler.py   ✅ покрыто
```

---

## 🐛 Отладка

### Включить подробные логи

В `.env`:
```bash
LOG_LEVEL=DEBUG
```

### Проверить webhook

```
/webhookinfo
```

```
Уровни логирования:
DEBUG   → Все детали (для разработки)
INFO    → Основные события (по умолчанию)
WARNING → Предупреждения
ERROR   → Ошибки
```

---

## 📚 Полная документация

Для детальной информации смотрите:
- [docs/TESTING.md](docs/TESTING.md) — подробное руководство
- [README.md](README.md) — основная документация
- [docs/CONFIGURATION.md](docs/CONFIGURATION.md) — настройка

```
Структура документации:
├─ TESTING_QUICKSTART.md  ← Вы здесь (быстрая шпаргалка)
├─ docs/TESTING.md         ← Подробное руководство
├─ README.md               ← Основная документация
└─ docs/CONFIGURATION.md   ← Настройка параметров
```

---

## ❓ Быстрые ответы на частые вопросы

**Q: Как тестировать без влияния на продакшен?**  
A: Используйте `python test_bot.py` — создается временная БД

**Q: Как получить ID группы для тестов?**  
A: Запустите `python get_chat_id.py` и отправьте сообщение в группу

**Q: Inline-кнопки не работают?**  
A: Проверьте `/webhookinfo` и убедитесь что `callback_query` в allowed_updates

**Q: Как быстро открыть опрос для теста?**  
A: После запуска `test_bot.py` отправьте `/open 1`

**Q: Можно ли тестировать с друзьями?**  
A: Да! Создайте тестовую группу, добавьте бота и друзей

**Q: Как сохранить тестовые данные между запусками?**  
A: Создайте `.env.test` с отдельной БД и запустите обычный бот с `ENV_FILE=.env.test`

---

## 🎨 Визуальная схема архитектуры тестирования

```
┌──────────────────────────────────────────────────────────────┐
│                    ТЕСТОВОЕ ОКРУЖЕНИЕ                         │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  test_bot.py                                                 │
│       │                                                      │
│       ├─→ Создает временную БД (/tmp/test_*.db)             │
│       │                                                      │
│       ├─→ Добавляет тестовый опрос                          │
│       │     ├─ Открытие: через 2 минуты                     │
│       │     └─ Игра: через 1 час                            │
│       │                                                      │
│       ├─→ Запускает бота (polling)                          │
│       │     ├─ Все команды доступны                         │
│       │     ├─ Планировщик активен                          │
│       │     └─ Работает в любом чате                        │
│       │                                                      │
│       └─→ При остановке (Ctrl+C)                            │
│             └─ Удаляет временную БД                         │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│  ПРОДАКШЕН ОКРУЖЕНИЕ (не затрагивается)                      │
│                                                              │
│  data/volleybot.db  ← Основная БД (в безопасности)           │
│  .env               ← Продакшен конфиг                       │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 🛠️ Доступные инструменты

| Инструмент | Назначение | Команда |
|------------|------------|---------|
| `test_bot.py` | Тестовый бот с временной БД | `python test_bot.py` |
| `get_chat_id.py` | Получить ID чата | `python get_chat_id.py` |
| `test_commands.sh` | Меню всех команд | `./test_commands.sh` |
| `manage.sh test` | Автоматические тесты | `./manage.sh test` |

---

## 💡 Советы профессионалов

1. **Быстрое тестирование**: `python test_bot.py` + `/open 1`
2. **Несколько аккаунтов**: Используйте тестовую группу
3. **Сохранить данные**: Создайте `.env.test` с отдельной БД
4. **Проверить кнопки**: Смотрите логи на `callback_query`
5. **Debug режим**: `LOG_LEVEL=DEBUG python test_bot.py`