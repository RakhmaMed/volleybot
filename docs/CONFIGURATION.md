# Руководство по конфигурации VolleyBot

Этот документ описывает все доступные параметры конфигурации бота и способы их настройки через переменные окружения.

## Способ настройки

Бот использует файл `.env` в корневой директории проекта для загрузки всех параметров. Также поддерживается установка переменных окружения напрямую.

### Начало работы

1. Скопируйте пример файла конфигурации:
   ```bash
   cp .env.example .env
   ```
2. Отредактируйте `.env`, указав ваши данные.
3. **Важно**: Никогда не добавляйте файл `.env` в систему контроля версий (git). Он уже включен в `.gitignore`.

---

## Параметры конфигурации (.env)

### Обязательные настройки Telegram

*   **`TELEGRAM_TOKEN`**: Токен вашего бота от [@BotFather](https://t.me/BotFather).
*   **`CHAT_ID`**: ID чата или группы, куда бот будет отправлять опросы (для групп начинается с `-100`).
*   **`ADMIN_USERNAME`**: Telegram username администратора (без символа `@`). Только этот пользователь сможет управлять ботом.

### Настройки Webhook (опционально)

Если параметры не указаны, бот запускается в режиме **Polling** (подходит для тестов и локального запуска).

*   **`WEBHOOK_HOST`**: Публичный URL вашего сервера (например, `https://your-domain.com`).
*   **`WEBHOOK_PATH`**: Путь для вебхука (по умолчанию `/webhook`).
*   **`WEBHOOK_SECRET`**: Секретный токен для проверки подлинности запросов от Telegram.
*   **`WEBHOOK_PORT`**: Порт, который будет слушать бот (по умолчанию `8443`).

### SSL сертификаты (для Webhook)

Обязательны, если используется режим Webhook без внешнего прокси (типа Nginx).

*   **`SSL_CERT_PATH`**: Путь к файлу сертификата (fullchain).
*   **`SSL_KEY_PATH`**: Путь к приватному ключу.

### Настройки приложения

*   **`MIN_PLAYERS`**: Минимальное количество игроков (по умолчанию `12`).
*   **`MAX_PLAYERS`**: Максимальное количество игроков в основном составе (по умолчанию `18`).
*   **`RESERVE_PLAYERS`**: Количество мест для запасных игроков (по умолчанию `3`).
*   **`POLL_OPTIONS`**: Варианты ответов в опросе через запятую (по умолчанию `Да,Нет`).
*   **`SCHEDULER_TIMEZONE`**: Часовой пояс для планировщика (по умолчанию `UTC`).
*   **`LOG_LEVEL`**: Уровень логирования (`DEBUG`, `INFO`, `WARNING`, `ERROR`).

---

## Конфигурация опросов (База Данных)

В отличие от системных настроек, **расписание опросов теперь хранится в базе данных SQLite** (`volleybot.db`).

Это позволяет изменять расписание "на лету" без перезагрузки бота.

### Параметры шаблона опроса в БД:
*   **`name`**: Уникальное техническое название опроса.
*   **`place`**: Место проведения (текстовое поле).
*   **`message`**: Текст сообщения, который будет отправлен в чат.
*   **`open_day`**: День недели для открытия (mon, tue, wed, thu, fri, sat, sun или `*`).
*   **`open_hour_utc` / `open_minute_utc`**: Время открытия опроса в формате UTC.
*   **`game_day`**: День проведения игры (день, когда опрос автоматически закроется).
*   **`game_hour_utc` / `game_minute_utc`**: Время начала игры в UTC (опрос закрывается за 30 минут до этого времени).

### Как управлять опросами
На данный момент управление опросами осуществляется напрямую через таблицу `poll_templates` в базе данных `volleybot.db` с помощью любого SQLite клиента. В будущих версиях будут добавлены административные команды в интерфейс бота.

---

## Работа со временем (UTC)

Все настройки времени в боте используют **UTC (Coordinated Universal Time)**.

**Пример для Москвы (MSK, UTC+3):**
*   Если вы хотите открыть опрос в 18:30 по Москве, укажите:
    *   Час: `15`
    *   Минуты: `30`

---

## Безопасность

1. **Защита данных**: База данных `volleybot.db` содержит балансы игроков и их ID. Ограничьте доступ к этому файлу на сервере.
2. **Секреты**: Никогда не передавайте ваш `TELEGRAM_TOKEN` и содержимое `.env` третьим лицам.